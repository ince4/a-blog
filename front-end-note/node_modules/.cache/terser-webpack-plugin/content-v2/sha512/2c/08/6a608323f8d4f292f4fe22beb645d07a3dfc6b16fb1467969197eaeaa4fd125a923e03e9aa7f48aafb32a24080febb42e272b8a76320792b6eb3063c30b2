{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{362:function(t,s,n){\"use strict\";n.r(s);var a=n(42),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[n(\"h1\",{attrs:{id:\"全局执行上下文出栈时机\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#全局执行上下文出栈时机\"}},[t._v(\"#\")]),t._v(\" 全局执行上下文出栈时机\")]),t._v(\" \"),n(\"blockquote\",[n(\"p\",[t._v(\"本节标题的提问来自 segmentfault \"),n(\"a\",{attrs:{href:\"https://segmentfault.com/q/1010000015608763\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"JS运行过程中，全局执行上下文一直在执行上下文栈中吗。\"),n(\"OutboundLink\")],1)])]),t._v(\" \"),n(\"h2\",{attrs:{id:\"结论\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#结论\"}},[t._v(\"#\")]),t._v(\" 结论\")]),t._v(\" \"),n(\"p\",[t._v(\"提问者本人的回答中得出了以下结论\")]),t._v(\" \"),n(\"ul\",[n(\"li\",[t._v(\"全局上下文会出栈，并不是一直在栈底。\")]),t._v(\" \"),n(\"li\",[t._v(\"执行全局代码（如通过浏览器控制台）的时候会再次创建全局上下文。\")]),t._v(\" \"),n(\"li\",[t._v(\"事件循环中执行队列中的事件时会再次创建上下文。\")])]),t._v(\" \"),n(\"p\",[t._v(\"我认为结论中第二点与第三点可以进行合并，因为全局同步代码也可以看作是宏任务（Task）\")]),t._v(\" \"),n(\"blockquote\",[n(\"p\",[t._v(\"前置知识点：\"),n(\"RouterLink\",{attrs:{to:\"/base/浏览器/事件循环.html\"}},[t._v(\"事件循环\")])],1)]),t._v(\" \"),n(\"img\",{attrs:{src:t.$withBase(\"/浏览器/16740fa4cd9c6937.webp\")}}),t._v(\" \"),n(\"p\",[t._v(\"在事件循环期间的某个时刻，主线程会开始运行最先进入宏任务队列的消息。被处理的消息会被移出队列，并作为输入参数来调用与之关联的函数。调用一个函数总是会为其创造一个新的执行上下文。\"),n(\"br\"),t._v(\"\\n函数的处理会一直进行到执行栈再次为空为止；然后事件循环将会处理队列中的下一个消息。\")]),t._v(\" \"),n(\"h2\",{attrs:{id:\"实例验证\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#实例验证\"}},[t._v(\"#\")]),t._v(\" 实例验证\")]),t._v(\" \"),n(\"h3\",{attrs:{id:\"例1\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#例1\"}},[t._v(\"#\")]),t._v(\" 例1\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-javascript extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[n(\"code\",[t._v(\"button\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"addEventListener\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'click'\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\tPromise\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"resolve\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"then\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Microtask 1'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\tconsole\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Listener 1'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\nbutton\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"addEventListener\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'click'\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\tPromise\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"resolve\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"then\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Microtask 2'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\tconsole\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Listener 2'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),n(\"h3\",{attrs:{id:\"例2\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#例2\"}},[t._v(\"#\")]),t._v(\" 例2\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-javascript extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[n(\"code\",[t._v(\"button\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"addEventListener\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'click'\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\tPromise\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"resolve\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"then\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Microtask 1'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\tconsole\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Listener 1'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\nbutton\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"addEventListener\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'click'\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\tPromise\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"resolve\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"then\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" console\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Microtask 2'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\tconsole\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"log\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Listener 2'\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\nbutton\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"click\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),n(\"h3\",{attrs:{id:\"执行结果\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#执行结果\"}},[t._v(\"#\")]),t._v(\" 执行结果\")]),t._v(\" \"),n(\"div\",{staticClass:\"language-javascript extra-class\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 例1中，通过鼠标点击 button 触发 DOM 事件，输出顺序为\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Listener 1'\")]),t._v(\" \\n\"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Microtask 1'\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Listener 2'\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Microtask 2'\")]),t._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 例2中，通过 click() 方法模拟触发 DOM 事件 输出顺序为\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Listener 1'\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Listener 2'\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Microtask 1'\")]),t._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'Microtask 2'\")]),t._v(\"\\n\")])])]),n(\"h3\",{attrs:{id:\"执行过程\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#执行过程\"}},[t._v(\"#\")]),t._v(\" 执行过程\")]),t._v(\" \"),n(\"ul\",[n(\"li\",[n(\"p\",[t._v(\"例1代码的执行顺序\")]),t._v(\" \"),n(\"ul\",[n(\"li\",[t._v(\"点击按钮\")]),t._v(\" \"),n(\"li\",[t._v(\"Listener 1 回调函数的执行上下文加入执行栈\")]),t._v(\" \"),n(\"li\",[t._v(\"promise.then() 加入微任务队列\")]),t._v(\" \"),n(\"li\",[t._v(\"执行 console.log('Listener 1')，Listener 1 回调函数的执行上下文出栈\")]),t._v(\" \"),n(\"li\",[t._v(\"此时执行栈为空，取出微任务执行 console.log('Microtask 1')\")]),t._v(\" \"),n(\"li\",[t._v(\"Listener 2 回调函数的执行上下文加入执行栈，重复以上过程\")])])]),t._v(\" \"),n(\"li\",[n(\"p\",[t._v(\"例2代码的执行顺序\")]),t._v(\" \"),n(\"ul\",[n(\"li\",[t._v(\"Listener 1 回调函数的执行上下文加入执行栈\")]),t._v(\" \"),n(\"li\",[t._v(\"promise.then() 加入微任务队列\")]),t._v(\" \"),n(\"li\",[t._v(\"执行 console.log('Listener 1')，Listener 1 回调函数的执行上下文出栈\")]),t._v(\" \"),n(\"li\",[t._v(\"此时执行栈中留有全局上下文 Listener 2 回调函数的执行上下文入栈\")]),t._v(\" \"),n(\"li\",[t._v(\"执行 console.log('Listener 2')，Listener 2 回调函数的执行上下文出栈\")]),t._v(\" \"),n(\"li\",[t._v(\"全局上下文出栈，执行栈为空，取出微任务执行 console.log('Microtask 1') 与 console.log('Microtask 2')\")])])])]),t._v(\" \"),n(\"p\",[t._v(\"通过示例执行过程可以观察到全局上下文并非一直停留在执行站中，出栈时机不同也可能会对事件执行结果造成影响。\")]),t._v(\" \"),n(\"hr\"),t._v(\" \"),n(\"p\",[t._v(\"深入学习：\")]),t._v(\" \"),n(\"p\",[n(\"a\",{attrs:{href:\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"EventLoop-MDN\"),n(\"OutboundLink\")],1),n(\"br\"),t._v(\" \"),n(\"a\",{attrs:{href:\"https://stackoverflow.com/questions/33869145/is-it-possible-for-global-execution-context-to-pop-off-the-execution-stack\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"is-it-possible-for-global-execution-context-to-pop-off-the-execution-stack\"),n(\"OutboundLink\")],1),n(\"br\"),t._v(\" \"),n(\"a\",{attrs:{href:\"https://www.youtube.com/watch?v=cCOL7MC4Pl0&t=1592s\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"Jake Archibald: In The Loop - JSConf.Asia\"),n(\"OutboundLink\")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);","extractedComments":[]}