# 观察者模式

## 1、定义
观察者模式定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新

![Image text](/JS实践/观察者模式)

> **使用场景**
> - 使用观察者模式定义具有依赖关系的独立对象，方便各自的修改和复用。
> - 一个对象的改变将导致其他一个或多个对象也发生改变时。
> - 创建链式触发机制。
> - ...

## 2、原理实现

### 定义被观察者类
```javascript
class Subject {
	constructor() {
		this.observers = []
	}
	// 增加订阅者
	add(observer) {
		this.observers.push(observer)
	}
	// 移除订阅者
	remove(observer) {
		this.observers.forEach((item, i) => {
			if (item === observer) {
				this.observers.splice(i, 1)
			}
		})
	}
	// 通知所有订阅者触发其更新操作
	notify() {
		this.observers.forEach((observer) => {
			observer.update(this)
		})
	}
}
```

### 定义观察者类
```javascript
class Observer {
    constructor() {
    }

    update() {
        console.log('updated')
    }
}
```

## 3、发布订阅模式
发布订阅模式广义上同样属于观察者模式。与经典的观察者模式不同之处在于发布者和订阅者之间不直接进行订阅事件和通知操作，而是通过一个事件中心进行间接的通信。  
发布者不会将消息直接发送给特定的订阅者，也无需了解有哪些订阅者。同样订阅者也可以订阅发布者发布一个或多个类别的发布内容，也无需了解有哪些发布者的存在。发布-订阅模式下事件的注册和触发都发生在独立于发布者和订阅者的事件中心上，耦合度更低。

![Image text](/JS实践/发布订阅模式)

### 与经典观察者模式的区别
- 观察者模式中，被观察者与观察者之间是直接关联、互相依赖的。而发布-订阅模式中，发布者与订阅者是不直接关联的，它们之间通过事件通道联系。
- 观察者模式中，被观察者发布通知，所有观察者都会收到通知。发布-订阅模式中，发布者发布通知，只有特定类型的订阅者会收到通知。
- 观察者模式中，被观察者发出状态更新通知后，观察者调用自身内部的更新方法。发布-订阅模式中，订阅者的更新是通过事件通道进行细节处理和响应更新的。

发布订阅模式与的观察者模式之间不存在优劣之分，实际应用过程中可以根据需求复杂程度、模块关联程度等因素进行选择。