# 观察者模式

## 1、定义
观察者模式定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新

![Image text](/JS实践/观察者模式)

> **使用场景**
> - 使用观察者模式定义具有依赖关系的独立对象，方便各自的修改和复用。
> - 一个对象的改变将导致其他一个或多个对象也发生改变时。
> - 创建链式触发机制。
> - ...

## 2、原理实现

### 定义被观察者类
```javascript
class Subject {
	constructor() {
		this.observers = []
	}
	// 增加订阅者
	add(observer) {
		this.observers.push(observer)
	}
	// 移除订阅者
	remove(observer) {
		this.observers.forEach((item, i) => {
			if (item === observer) {
				this.observers.splice(i, 1)
			}
		})
	}
	// 通知所有订阅者触发其更新操作
	notify() {
		this.observers.forEach((observer) => {
			observer.update(this)
		})
	}
}
```

### 定义观察者类
```javascript
class Observer {
    constructor() {
    }

    update() {
        console.log('updated')
    }
}
```

## 3、发布订阅模式
发布订阅模式广义上同样属于观察者模式。与经典的观察者模式不同之处在于发布者和订阅者之间不直接进行订阅事件和通知操作，而是通过一个事件中心进行间接的通信。

![Image text](/JS实践/发布订阅模式)

发布-订阅模式下事件的注册和触发都发生在独立于发布者和订阅者的事件中心上，耦合度更低。